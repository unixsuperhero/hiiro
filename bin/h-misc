#!/usr/bin/env ruby

require 'hiiro'

Hiiro.run {
  add_subcmd(:symlinks) do |*args|
    opts = Hiiro::Options.parse(args) do
      option(:root, short: :r, desc: 'root path')
    end

    pwd = Hiiro::Paths.new(Dir.pwd)
    outside_basedir = opts.args.inject({}) do |h,basedir|
      symlinks = pwd.symlinks_in(basedir)

      outside_dir = symlinks
        .reject{|l| l.dest_in_dir?(basedir) }
        .tap do |outside|
          outside.each do |link,dest|
            puts
            puts "LINK: #{link}"
            puts "DEST: #{dest}"
            puts "is outside => #{real_base}"
          end
        end
    end
  end
}

