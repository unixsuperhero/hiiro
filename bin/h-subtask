#!/usr/bin/env ruby

# Shorthand for `h task subtask`

require "hiiro"
require "fileutils"
require "yaml"
require "time"

Hiiro.load_env
hiiro = Hiiro.init(*ARGV, plugins: [Tmux, Task])

tasks = hiiro.task_manager

hiiro.add_subcmd(:edit) { system(ENV['EDITOR'] || 'nvim', __FILE__) }
hiiro.add_subcmd(:list) { tasks.list_subtasks }
hiiro.add_subcmd(:ls) { tasks.list_subtasks }
hiiro.add_subcmd(:new) { |subtask_name| tasks.new_subtask(subtask_name) }
hiiro.add_subcmd(:switch) { |subtask_name=nil| tasks.switch_subtask(subtask_name) }
hiiro.add_subcmd(:app) { |app_name| tasks.subtask_open_app(app_name) }
hiiro.add_subcmd(:path) { |app_name=nil| tasks.subtask_app_path(app_name) }
hiiro.add_subcmd(:cd) { |*args| tasks.subtask_cd_app(*args) }
hiiro.add_subcmd(:apps) { tasks.list_configured_apps }
hiiro.add_subcmd(:status) { tasks.subtask_status }
hiiro.add_subcmd(:st) { tasks.subtask_status }
hiiro.add_subcmd(:save) { tasks.save_subtask }
hiiro.add_subcmd(:stop) { |subtask_name=nil| subtask_name ? tasks.stop_subtask(subtask_name) : tasks.stop_subtask }
hiiro.add_subcmd(:current) { print tasks.current_subtask_name }

hiiro.add_default { tasks.subtask_help }

hiiro.run
